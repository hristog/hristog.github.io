<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Converting Unicode representations to ASCII in Python — Conscious Automaton</title>
  <meta name="author" content="Hristo">
  <meta name="description" content="&gt;&gt;&gt; from hristog.thoughts import random">
  <link href="/atom.xml" title="Conscious Automaton Feed" type="application/atom+xml" rel="alternate" />

  <!-- Mobile Specific Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <!-- Font
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css"> -->

  <!-- CSS -->
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/github.css">
  <link rel="stylesheet" href="/css/sedimental.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/img/favicon.png">

  <!-- Analytics -->
  
  <script type="text/javascript">
      var _gaq = _gaq || [];
        
        _gaq.push(['user._setAccount', 'UA-102558598-1']);
        _gaq.push(['user._trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
  </script>
  
</head>
<body>
  <div class="table-container">
    <div class="table-block footer-push">
      <div class="container">
        <div class="row">
          <div id="layer-accent-div-1"></div>
          <div id="layer-accent-div-2"></div>
          <div id="layer-accent-div-3"></div>
          <header id="header" class="twelve columns">
            <h1><a href="/">Conscious Automaton</a></h1>
            <p id="tagline-p">&gt;&gt;&gt; from hristog.thoughts import random</p>
            <p id="pri-links-p">
              
              <a  title="" href="/tagged/data-science">Data Science</a>
              
              <a  title="" href="/tagged/sports-analytics">Sports Analytics</a>
              
              <a  title="" href="/tagged/python">Python</a>
              
              <a  title="" href="/tagged/linux">Linux</a>
              
              <a  title="" href="/about.html">About</a>
              
            </p>
            <p id="sec-links-p">
            
              <a  title="" href="/tagged/NLP">Natural Language Processing</a>&nbsp;
            
              <a  title="" href="/tagged/fantasy-football">Fantasy Football Analysis</a>&nbsp;
            
            </p>
            <!-- A horrible hack for inlining SVG-based links -->
            <span class="social-media-list">
            <a href="https://github.com/hristog" target="_blank"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
            </span><span class="username">hristog</span></a>

            <a href="https://twitter.com/hristogeo" target="_blank"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#4099FF" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
            </span><span class="username">hristogeo</span></a>
            </span>
            <!-- End of hack -->
            <hr>
          </header>
        </div>
        


<div class="row">
  <div class="twelve columns entry-div">
    <header id="entry-header">
      <h1 id="entry-h1">Converting Unicode representations to ASCII in Python</h1>
      <p id="entry-tagline"></p>
    </header>
      <p><h2 id="python_and_unicode"><a class="toclink" href="#python_and_unicode">Python and Unicode</a></h2>
<p>Oh, my - If I had a nickel/five-pence every time I had to deal with various kinds
of Unicode-related processing in Python ...</p>
<p>Anyway, this brief note is for those of you who've ever run into a not-so-helpful error message, along the lines of the following:</p>
<div class="codehilite"><pre><span class="ne">UnicodeEncodeError</span><span class="p">:</span> <span class="s">'ascii'</span> <span class="n">codec</span> <span class="n">can</span><span class="s">'t encode character u'</span>\<span class="n">xef</span><span class="s">' in position 2: ordinal not in range(128)</span>
</pre></div>


<p>I'd bet those of you who have used Python for a bit larger than trivial project have invariably <a href="https://duckduckgo.com/?q=Python+UnicodeEncodeError">encountered</a>
some variety of it.</p>
<p>Let's see how we could approach this issue<sup id="fnref:python_version"><a rel="footnote" class="footnote-ref" href="#fn:python_version">1</a></sup> in different ways. For this purse, I'll first go
ahead and  define a
simple use-case: we're experimenting with a given dataset and we want to run a number of
Machine Learning methods against the dataset and output a nice log file with performance
summary and results for each method.</p>
<p>As it turns out, not all ML method names were created equal, and for some of them
we need more characters than those defined in the basic ASCII table:</p>
<div class="codehilite"><pre><span class="c"># Python 2.7.12</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">method</span> <span class="o">=</span> <span class="s">u'Naïve Bayes'</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">method</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s">u'Na</span><span class="se">\xef</span><span class="s">ve Bayes'</span>
</pre></div>


<p>So far so good - Python has successfully been able to encode our special character
<code>ï</code> as <code>\xef</code>. However, once we attempt to put that into a non-unicode string, all hell
breaks loose:</p>
<div class="codehilite"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">method_filename</span> <span class="o">=</span> <span class="s">'{}_method.log'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">))</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">UnicodeEncodeError</span>                        <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">31</span><span class="o">-</span><span class="n">c5a4e402b551</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">method_filename</span> <span class="o">=</span> <span class="s">'{}_method.log'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">))</span>

<span class="ne">UnicodeEncodeError</span><span class="p">:</span> <span class="s">'ascii'</span> <span class="n">codec</span> <span class="n">can</span><span class="s">'t encode character u'</span>\<span class="n">xef</span><span class="s">' in position 2: ordinal not in range(128)</span>
</pre></div>


<p>At this point, we have a couple of options: ignore-and-remove the problematic character or
try to somehow convert it to an approximate representation that is part of the
ASCII character set. Let's explore the former option first:</p>
<div class="codehilite"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s">'{}_method.log'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">,</span> <span class="s">'ignore'</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s">'Nave_Bayes_method.log'</span>
</pre></div>


<p>Fair enough, it works and we get what we pay for it, but surely we could do better,
right?</p>
<p>Alternatively, if we're happy with non-ASCII file names occupying our file system, we
could just do:</p>
<div class="codehilite"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">method_filename</span> <span class="o">=</span> <span class="s">u'{}_method.log'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">method_filename</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s">u'Na</span><span class="se">\xc3\xaf</span><span class="s">ve_Bayes_method.log'</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">method_filename</span><span class="p">)</span>
<span class="n">Na</span><span class="err">ï</span><span class="n">ve_Bayes_method</span><span class="o">.</span><span class="n">log</span>
</pre></div>


<p>However, that's not really the point of this exercise. Let's see if we could do even better.</p>
<div class="codehilite"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">unicodedata</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">method_filename</span> <span class="o">=</span> <span class="s">'{}_method.log'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
                <span class="s">'NFKD'</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                     <span class="s">'ascii'</span><span class="p">,</span> <span class="s">'ignore'</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">method_filename</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s">'Naive_Bayes_method.log'</span>
</pre></div>


<p>This is where the <a href="https://docs.python.org/2/library/unicodedata.html"><code>unicodedata</code></a> module from the Python Standard
Library comes to the rescue. In this case, either of the <code>NFD</code> or <code>NFKD</code> normalizations would work, as
described in the documentation:</p>
<blockquote>
<p>[Canonical decomposition] translates each character into its decomposed form.</p>
</blockquote>
<p>This is exactly what we needed, wasn't it? An equivalent ASCII representation of our fancy
ML method names.</p>
<p>Finally, I would like to give credit to a StackOverflow <a href="https://stackoverflow.com/a/7782177">answer</a>, from which I
learned about the <code>unicodedata.normalize</code> functionality that gave rise to the current post.</p>
<p>Happy debugging of <code>UnicodeError</code>s, everybody :)</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:python_version">
<p>Please, note that the code examples accompanying this post are
relevant to Python v2 - which has been labeled as "Legacy Python", in the context of
the official community discontinuing its support in 2020 - and,
particularly, <code>Python 2.7.12</code>. <a rev="footnote" title="Jump back to footnote 1 in the text" class="footnote-backref" href="#fnref:python_version">↩</a></p>
</li>
</ol>
</div><p></p>



<hr />


  </div>
  <div class="twelve columns metadata metadata-div">
    <a href="/converting_unicode_representations_to_ascii_in_python.html" title="2017-10-29T00:00:00+0100" class="date post-timestamp">Oct 29th, 2017</a>
  </div>
  <div class="twelve columns metadata metadata-div">
    
    <span class="tags">
      <a href="/tagged/python">#python</a> <a href="/tagged/python-v2">#python-v2</a> <a href="/tagged/unicode">#unicode</a> <a href="/tagged/text-processing">#text-processing</a> 
    </span>
    
  </div>
  
  <div class="twelve columns" id="previously-div">
    <h5>Previously</h5>
    
    <a href="/team_play_contributions_of_the_top_defenders_for_the_fpl_season_2016_2017.html">Team-Play Contributions of the Top Defenders for the FPL Season 2016/2017</a><br/>
    
    <a href="/team_play_contributions_of_the_top_midfielders_for_the_fpl_season_2016_2017.html">Team-Play Contributions of the Top Midfielders for the FPL Season 2016/2017</a><br/>
    
    <a href="/playing_time_conversion_efficiency_for_the_fpl_season_2016_2017.html">Playing Time Conversion Efficiency for the FPL Season 2016/2017</a><br/>
    
    <a href="/team_play_contributions_of_the_top_forwards_for_the_fpl_season_2016_2017.html">Team-Play Contributions of the Top Forwards for the FPL Season 2016/2017</a><br/>
    
    <a href="/fantasy_football_total_points_contributions_for_season_2016_2017.html">Fantasy Football Total Points Contributions for Season 2016/2017</a><br/>
    
  </div>
  
</div>



      </div> <!-- End header/content container -->
    </div>
    <div class="table-block">
      <div class="container">
        <footer id="footer" class="twelve columns">
          &copy; 2017 <a href="https://creativecommons.org/licenses/by-sa/4.0/"><img height="14" src="/img/by-sa.png" /></a> <a href="/atom.xml"><img height="14" src="/img/feed.png"></a>
        </footer>
      </div>
    </div>  <!-- end table block footer div -->
  </div>
  <!-- Last generated: 2017-11-05T00:13:20Z -->
</body>
</html>





